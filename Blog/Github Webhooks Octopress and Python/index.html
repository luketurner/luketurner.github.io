<!DOCTYPE html>
<html>
<head>

		
	<meta charset="utf-8">
	<title>Github, Webhooks, Octopress, and&nbsp;Python - Luke Turner</title>
	<meta name="author" content="Luke Turner">
	<meta name="description" content="I'm blagging behind">
	
		<link href="/theme/css/style.min.css?3a5d3c86" rel="stylesheet" >
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
		<script src="/theme/js/base.min.js?07bbe624" type="text/javascript"></script>





</head>
<body>
	<div id="wrapper">
		<header>
			<h1><a href="/">Luke Turner</a></h1><div id="secretnav" style="display:none;">what is love?</div><a href="#" id="expander">⇉</a>

		</header>
		<div id="sidebar">

	
	


		</div>

		<div id="content">
<section id="content" class="body">
		<h2>
			<a href="/Blog/Github%20Webhooks%20Octopress%20and%20Python" rel="bookmark" title="Permalink to Github, Webhooks, Octopress, and Python">
				Github, Webhooks, Octopress, and&nbsp;Python
			</a>
		</h2>
	<div class="entry-content">
		<aside>Update: I no longer use this setup, instead publishing my blog with <a href="http://getpelican.com">pelican</a>.</aside>

<p>You might be aware that <a href="https://github.com/">Github</a> has <a href="https://help.github.com/articles/post-receive-hooks">Post-receive hooks</a>. Basically, when you push to a repository with a post-receive hook set up, Github will do something for you. Now, they have a <span class="caps">TON</span> of such hooks, for all kinds of services from ActiveCollab to ZohoProjects (whatever that&nbsp;is).</p>
<p>My personal favorite, though, is the WebHook <span class="caps">URL</span> &#8220;service.&#8221; What this does is send a <span class="caps">POST</span> request to a specified <span class="caps">URL</span> whenever the repository is pushed to. This lets us set up a pretty straightforward blog-editing workflow, where we can create new posts right in Github (or maybe using something like <a href="http://prose.io">prose.io</a>). </p>
<p>The reason this is necessary at all is because <a href="http://octopress.org/">Octopress</a>, a blogging platform that&#8217;s basically a bunch of Jekyll plugins, can&#8217;t be compiled automatically by Github Pages (it&#8217;s compiled with a Rake task). It&#8217;s <a href="http://octopress.org/docs/deploying/github/">easy enough</a> to deploy to Pages, but then you have to have a shell in the source repository to run <code>rake generate &amp;&amp; rake deploy</code>.</p>
<p>We want that to happen automatically: whenever the <strong>source</strong> branch on Github is pushed to, Github makes a WebHooks request to our server, which pulls the updated source tree, generates the site, and deploys it to the <strong>master</strong> branch. The question is, how do we want to handle Github&#8217;s WebHooks request&nbsp;server-side?</p>
<p>There are a lot of options. Basically any Web framework or Web server could do it. You could probably also use something like Jenkins (another Github post-receive hook). There are probably also cloud platforms that could handle it&nbsp;automatically.</p>
<p>Here&#8217;s what I&#8217;ve done. I wrote a simple Python program&nbsp;that:</p>
<ol>
<li>Gets the incoming&nbsp;requests.</li>
<li>Does some sketchy validation to see if it&#8217;s really Github and that the <strong>source</strong> branch was the one&nbsp;edited.</li>
<li>Basically runs <code>git pull origin source &amp;&amp; rake generate &amp;&amp; rake deploy</code></li>
</ol>
<p>The code is very short so I&#8217;ll just include it&nbsp;here.</p>
<p>{% gist 6286112&nbsp;%}</p>
<p>Note it&#8217;s set to run on port 5000. On my instance it runs on a different port to prevent&nbsp;malice.</p>
<p>So: on my server I&#8217;ve got this program running in a tmux session (the poor man&#8217;s service!) When I edit the <strong>source</strong> branch on my Github repo, it <span class="caps">POSTS</span> my server, which pulls the changes and generates the new site and deploys it back to&nbsp;Github.</p>
<p>If you want to set this up for yourself, there are a few things to&nbsp;note:</p>
<ul>
<li>Read my code! There&#8217;s a reference to my blog directory hardcoded into it. You&#8217;re gonna have to change&nbsp;it.</li>
<li>You have to <a href="http://octopress.org/docs/deploying/github/">set up Octopress to deploy to github pages</a>. You also have to use the <span class="caps">SSH</span> access point for the repository (the <span class="caps">HTTPS</span> access point requires password&nbsp;authentication).</li>
<li>You have to set up the WebHook <span class="caps">URL</span> service in your Github repository. This is done under <em>Settings -&gt; Service Hooks</em>.</li>
<li>Your server needs Python 2.x and Flask to run the&nbsp;thing.</li>
</ul>
<p>For some reason, I can&#8217;t bring myself to just use&nbsp;Wordpress.</p>
	</div><!-- /.entry-content -->
</section>
		</div>

		<footer>
			<p>Copyright Luke Turner 2013</p>
		</footer>
	</div>
</body>
</html>